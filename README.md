# 2020年安卓期末设计


最后测试运行时间2020年7月5日（爬虫有时效性）

	整个库是安卓studio里上传的，（git用的不熟练，文件有些乱）

	git文件夹是服务器端的代码

		1.服务器端主要是用python写的，字节加密调用的exe。

		2.exe源码就是同名的cpp（略微区别，可能打印的东西不一样，主要的字节处理时一样的）。

		3.hello.java没啥用		//hello.java是模拟手机端测试程序用的(hello.java有的安卓工程里都有)
		
	数据库是在虚拟机里建的，只有一个表
	'''
		Create table myuserdata(
			id int unsigned AUTO_INCREMENT PRIMARY KEY,
			email nvarchar(100) not null unique KEY,
			name Nvarchar(100) ,
			sex TINYINT DEFAULT 2 ,
			password Char(32) not null,
			loginNewtime DOUBLE Unsigned not null,
			userHeadmd5 Char(32),
			userHeadend char(5) DEFAULT '.head',
			life TINYINT unsigned,
				)ENGINE=InnoDB DEFAULT CHARSET=utf8;
		'''
	
注册界面改了一个调试用参数。（当时为了调试方便把邮箱写死了。检查个人信息的时候，才发现没改过来。。。已经重新改为变量）

部分注释是复制前面的代码，没有改，不要完全相信注释。

Android实验实训项目

一、开发环境

安卓：

	1.Android Studio 3.6.1(Build #A1-192.7142.36.36.6241897,built on February 27,1010)

	2.jre 1.8.0_212-release-1586-b04 and64

	3.jvm OpenJDK 64-Bit Server VM by JetBrains s.r.o

服务器：

	1.python 3.7.4（64-bit）

	2.Visual Studio 2019

	3.MySql 8.0

	4.Windows 10

二、项目目标

布局内容：

	1.首页列表视图显示信息

	2.用户密码登录

	3.用户邮箱登录
	
	4.用户注册
	
	5.用户信息展示
	
	6.用户信息修改
	
服务器内容：

	1.用户注册服务
	
	2.用户登录服务
	
	3.用户信息同步服务
	
	4.用户主页内容提供
	
三、项目结果

布局展示/功能介绍

1.首页

	实现的功能：

	1.	进入页面加载来自服务器的新闻标题和来自网络的图片①。

	2.	点击“新闻”、“订阅”可以刷新/切换列表视图的内容。

	3.	查询本地sqlite数据库，自动登录上一次登录后未注销的用户。

	4.	“图片”、“其他”按键内容未实现，点击后无实际功能。

	5.	点击右上角“三个点”显示菜单“用户”、“登录”、“注销”。

	6.	点击“用户”跳转到已经登陆的用户信息界面，否则跳转到登陆页面。

	7.	点击“登录”跳转到登陆界面。

	8.	点击“注销”会清除当前登录的用户信息。

	9.	同一时间只能登陆一个用户，如果登录的用户与之前不同，则自动注销先前登录用户，同时自动记录最后登录用户的邮箱。

	10.	接收、处理登录界面和用户界面传回的数据。

	注①：服务器提供的列表视图内容来自http://www.people.com.cn/和https://www.zhihu.com/hot。自己写的Python爬虫，5分钟爬取一次，更新服务器数据。

2.用户密码登录界面

	实现的功能：

	1．	登录按键仅校验邮箱和密码内容，不提供登录功能①。

	2．	点击“邮箱登录”跳转到邮箱“登录页面”。

	3．	点击“注册”跳转到“注册页面”。

	4．	转发注册布局和邮箱登录布局打包的数据给主页面。

	注①：密码功能没有实现。

3.用户邮箱登录界面

	实现的功能：

	1．	点击“发送验证码”正则校验邮箱是否合法，合法则发送post请求。服务器收到post请求后，使用SMTP服务发送验证码到用户的邮箱。

	2．	点击“登录”按键，校验邮箱是否发送邮件、验证码是否合法，验证通过则发送post请求，内容为验证码加密的邮箱。

	3．	接受“发送邮件”post返回的数据，储存返回的校验码。

	4．	接受并处理“登录”的post返回的数据。登录成功则同步用户的头像、名称、性别信息，打包后返还启动邮箱登录布局的布局。

4.用户注册页面

	实现的功能：

	1.	点击“发送验证码”正则校验邮箱是否合法。合法则向服务器发送post请求。

	2.	点击“注册”正则校验各个数据框的数据是否合法，邮箱是否发送过验证码。校验通过则发送post请求，携带的数据为验证码加密的邮箱密码信息等。

	3.	接受“发送邮件”post返回的数据，储存返回的校验码。

	4.	接受并处理“注册”的post返回的数据。注册成功则打包用户邮箱数据返还启动注册布局的布局。

5.用户信息展示页面

	实现的功能
	
	1．	接受主页面传来的用户信息。
	
	2．	判断用户是否有头像。如果有先尝试从应用安装目录下的files文件夹加载用户头像，加载失败就从服务器加载用户头像，同时储存在files文件夹。
	
	3．	显示其他用户信息。
	
	4．	点击右上角三个点儿，显示菜单栏。菜单栏只有一个“编辑”按键。
	
	5．	点击“编辑”按键携带用户信息跳转到编辑用户信息界面。
	
	6．	接受、储存编辑用户信息界面最后一次传回的数据，并转发给主布局。
	
6.用户信息修改页面

	实现的功能：

	1.	打开后加载用户信息。从files文件夹加载头像，但是不再从网络加载。

	2.	点击“取消”按键返回用户登录页面。

	3.	点击“选择头像图片”先判断是否有权限，否则尝试获取权限。有权限之后打开手机提供的相册界面，选择图片。

	4.	接受手机提供的相册界面传回图片文件的uri，并转换为真实文件路径①。读取文件加载到头像的显示窗口，同时求取文件的MD5并储存。

	5.	点击“保存”按键校验数据后更新本地sqlite数据库，发送post同步数据给服务器端，post发送头像图片给服务器②。启动线程检查post请求是否成功，失败则重新发送请求。

	6.	三个Handler。分别处理用户文字信息poat请求、用户头像post请求、检查前两项成功后关闭修改用户信息界面。

	注①	：文件uri转换真实路径使用了https://www.jianshu.com/p/f13dfd5a823e 的代码（类名 FileUtil ）。因为他的转换对Android各版本有处理。直接字符串剪裁拼接得到的真实文件路径可能不兼容。

	注②	：头像文件储存在服务器运行web文件目录的head文件夹里，用文件的MD5（去重）加“.head”命名。









